<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:color="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Winery:: Cadastro Cliente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </head>
  <style>
    .bodyWinery {
            background-image: url('../static/imagens/3.png') !important;
            background-size: cover !important;
            background-repeat: no-repeat !important;
            background-attachment: fixed !important;
        }
        .corFundo {
            background: linear-gradient(to bottom, #000000, #000000f0);
            border-radius: 14px;
            padding: 15px;
        }
    .fundoDoFormulario {
        background: linear-gradient(to bottom, #000000, #000000f0);
    }
  </style>
  <body class="bodyWinery">
    <nav class="navbar navbar-expand-lg bg-body-tertiary corFundo">
        <div class="container-fluid">
            <a class="navbar-brand" href="/Winery">
                <img th:src="@{/imagens/logoWinery250x250new.png}" width="150px" alt="Logo da Winery">
            </a>
    
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
    
    
                </ul>
    
                <ul class="navbar-nav ml-auto">
    
                    <li class="nav-item ml-auto">
                        <a class="nav-link text-white" href="#">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart3" viewBox="0 0 16 16">
                                <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                            </svg>
                            Carrinho
                        </a>
                    </li>
                   
                    <li class="nav-item ml-auto">
                        <a class="nav-link text-white" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                              </svg>
                            Entrar
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Modal
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-conten fundoDoFormulario">
            <div class="modal-header">
            <h5 class="modal-title text-white" id="loginModalLabel">Entrar</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <form>
                <div class="mb-3">
                <label for="email" class="form-label text-white">Email</label>
                <input type="email" class="form-control" id="email">
                </div>
                <div class="mb-3">
                <label for="password" class="form-label text-white">Senha</label>
                <input type="password" class="form-control" id="password">
                </div>
                <button type="submit" class="btn btn-primary">Entrar</button>
                <button type="submit" class="btn btn-secondary">Cadastrar</button>
            </form>
            </div>
        </div>
        </div>
    </div> -->
    <div class="container corFundo">
        <h2 class="text-white">Formulario de Cadastro</h2>
        <form class="row g-3" th:action="@{/Winery/cadastrarCliente}" method="post" th:object="${cliente}" id="formCadastroCliente"  enctype="multipart/form-data">
          <div id="modalMessages" class="position-absolute"></div>
  
          <div class="col-md-6">
                <label for="" class="form-label text-white">Nome completo</label>
                <input type="text" class="form-control" id="nome" name="nome">
              </div>
              <div class="col-md-3">
                <label for="inputGenero" class="form-label text-white">Gênero</label>
                <select id="inputGenero" class="form-select">
                  <option selected>Masculino</option>
                  <option>Feminino</option>
                </select>
              </div>
              <div class="col-md-3">
                <label for="" class="form-label text-white">Data de Nascimento</label>
                <input type="date" class="form-control" id="dataNascimento" name="dataNascimento">
              </div>
              <div class="col-md-6">
                <label for="" class="form-label text-white">CPF</label>
                <input type="text" class="form-control" id="cpf" name="cpf">
              </div>
            <div class="col-md-6">
              <label for="" class="form-label text-white">Email</label>
              <input type="email" class="form-control" id="email" name="email">
            </div>
            <div class="col-md-6">
              <label for="" class="form-label text-white">Digite a senha:</label>
              <input type="password" class="form-control" id="senha" name="senha">
            </div>
            <div class="col-md-6">
                <label for="" class="form-label text-white">Confirme a senha:</label>
                <input type="password" class="form-control" id="confirmaSenha" name="confirmaSenha">
              </div>
            <div class="col-6">
              <label for="" class="form-label text-white">Logradouro</label>
              <input type="text" class="form-control" id="logradouro" name="logradouro" placeholder="1234 Main St">
            </div>
            <div class="col-3">
                <label for="" class="form-label text-white">Numero</label>
                <input type="text" class="form-control" id="numero" name="numero" placeholder="1234 Main St">
              </div>
            <div class="col-3">
                <label for="" class="form-label text-white">Complemento</label>
                <input type="text" class="form-control" id="complemento" name="complemento" placeholder="1234 Main St">
              </div>
            <div class="col-md-3">
                <label for="" class="form-label text-white">Bairro</label>
                <input type="text" class="form-control" id="bairro" name="bairro">
              </div>
            <div class="col-md-3">
                <label for="" class="form-label text-white">CEP</label>
                <input type="text" class="form-control" id="cep" name="cep" minlength="8" maxlength="8">
            </div>
            <div class="col-md-3">
                <label for="" class="form-label text-white">UF</label>
                <input type="text" class="form-control" id="uf" name="uf">
            </div>
            <div class="col-md-3">
              <label for="" class="form-label text-white">Cidade</label>
              <input type="text" class="form-control" id="cidade" name="cidade">
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#enderecoModal">Adicionar endereço de faturamento</button>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Cadastrar</button>
            </div>
          </form>
    </div>
    </div>
     Modal Endereco
     <div class="modal fade" id="enderecoModal" tabindex="-1" aria-labelledby="enderecoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
        <div class="modal-content fundoDoFormulario">
            <div class="modal-header">
            <h5 class="modal-title text-white" id="enderecoModalLabel">Endereço de faturamento</h5>
            <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close" style="background-color: white;"></button>
            </div>
            <div class="modal-body">
            <form class="row g-3">
                <div class="col-6">
                    <label for="inputAddress" class="form-label text-white">Logradouro</label>
                    <input type="text" class="form-control" id="inputLogradouro" placeholder="1234 Main St">
                  </div>
                  <div class="col-3">
                      <label for="inputComplemento" class="form-label text-white">Numero</label>
                      <input type="text" class="form-control" id="inputNumero" placeholder="1234 Main St">
                    </div>
                  <div class="col-3">
                      <label for="inputComplemento" class="form-label text-white">Complemento</label>
                      <input type="text" class="form-control" id="inputComplemento" placeholder="1234 Main St">
                    </div>
                  <div class="col-md-3">
                      <label for="inputBairro" class="form-label text-white">Bairro</label>
                      <input type="text" class="form-control" id="inputBairro">
                    </div>
                  <div class="col-md-3">
                      <label for="inputCEP" class="form-label text-white">CEP</label>
                      <input type="text" class="form-control" id="inputCep">
                  </div>
                  <div class="col-md-3">
                    <label for="inputCity" class="form-label text-white">Cidade</label>
                    <input type="text" class="form-control" id="inputCidade">
                  </div>
                  <div class="col-md-3">
                    <label for="inputCity" class="form-label text-white">UF</label>
                    <input type="text" class="form-control" id="inputUf">
                  </div>
                  
                    <div class="col-12">
                      <button type="submit" class="btn btn-primary">Adicionar endereço ao cadastro</button>
                    </div>
            </form>
            </div>
        </div>
        </div>
    </div>
    
  
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script>

    $(document).ready(function () {
    $('#formCadastroCliente').on('submit', function (event) {
        event.preventDefault();

        var cliente = {
            nome: document.getElementById('nome').value,
            genero: document.getElementById('inputGenero').value,
            dataNascimento: document.getElementById('dataNascimento').value,
            cpf: document.getElementById('cpf').value,
            email: document.getElementById('email').value,
            senha: document.getElementById('senha').value,
            confirmaSenha: document.getElementById('confirmaSenha').value,
            endereco: [
                {
                    logradouro: document.getElementById('logradouro').value,
                    numero: document.getElementById('numero').value,
                    complemento: document.getElementById('complemento').value,
                    bairro: document.getElementById('bairro').value,
                    cep: document.getElementById('cep').value,
                    uf: document.getElementById('uf').value,
                    cidade: document.getElementById('cidade').value,
                    estado: document.getElementById('estado').value
                }
            
            ]
        };
        console.log(JSON.stringify(cliente));
        $.ajax({
            type: 'POST',
            url: '/Winery/cadastrarCliente',
            data: JSON.stringify(cliente),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                $('#modalMessages').empty();

                if (data.startsWith('Sucesso:')) {
                    var mensagemSucesso = data.replace('Sucesso:', '');
                    $('#modalMessages').append('<div class="alert alert-success" role="alert">' + mensagemSucesso + '</div>');

                    $('#formCadastroCliente')[0].reset();

                    setTimeout(function () {
                        $('#myModal').modal('hide');
                        location.reload();
                    }, 3500);

                } else if (data.startsWith('Erro:')) {
                    var mensagemErro = data.replace('Erro:', '');
                    $('#modalMessages').append('<div class="alert alert-danger" role="alert" data-toggle="popover" data-trigger="manual" data-placement="top">' + mensagemErro + '</div>').find('.alert').popover('show');
                }
            },
            error: function (xhr) {
                $('#modalMessages').empty();

                var mensagemErro = xhr.responseText;
                $('#modalMessages').append('<div class="alert alert-danger" role="alert">' + mensagemErro + '</div>');
            }
        });
    });
});



document.addEventListener("DOMContentLoaded", () => {
  addEventListeners();
});

const addEventListeners = () => {
  document
    .getElementById("cep")
    .addEventListener("blur", handleCEPBlur());
  document
    .getElementById("inputCep")
    .addEventListener("blur", handleCEPBlur());
};

const handleCEPBlur = () => (e) => {
  if (e.target.value.length >= 8) {
    var valor = e.target.id.toLowerCase();  // ou toUpperCase()
console.log(valor)
    if (valor.startsWith("input")) {
      fetchAddress2();
    } else {
      fetchAddress();
    }
    
  }
};


const fetchAddress = () => {
  let cep = document.getElementById('cep');
  // let addressFields = document.getElementById(`${prefix}AddressFieldsInfo`);

  fetch(`https://viacep.com.br/ws/${cep.value}/json/`)
    .then((response) => response.json())
    .then((data) => {
      if (data.erro) {
        alert("CEP não encontrado!");
      } else {
        document.getElementById('logradouro').value = data.logradouro;
        document.getElementById('bairro').value = data.bairro;
        document.getElementById('cidade').value = data.localidade;
        document.getElementById('uf').value = data.uf;
      }
    })
    .catch(() => {
      alert("Erro ao buscar o CEP!");
    });
};

const fetchAddress2 = () => {
  let cep = document.getElementById('inputCep');
  // let addressFields = document.getElementById(`${prefix}AddressFieldsInfo`);

  fetch(`https://viacep.com.br/ws/${cep.value}/json/`)
    .then((response) => response.json())
    .then((data) => {
      if (data.erro) {
        alert("CEP não encontrado!");
      } else {
        document.getElementById('inputLogradouro').value = data.logradouro;
        document.getElementById('inputBairro').value = data.bairro;
        document.getElementById('inputCidade').value = data.localidade;
        document.getElementById('inputUf').value = data.uf;
      }
    })
    .catch(() => {
      alert("Erro ao buscar o CEP!");
    });
};


  </script>
  </body>
</html>